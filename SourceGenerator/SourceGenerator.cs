using Microsoft.CodeAnalysis;
using static System.Net.Mime.MediaTypeNames;
using System.Xml.Linq;

namespace SourceGenerator
{
    [Generator]
    public class HelloSourceGenerator : ISourceGenerator
    {

        public void Execute(GeneratorExecutionContext context)
        {

            var files = System.IO.Directory.GetFiles("nodes");


            for (int i = 0; i < files.Length; i++)
            {
                var name = files[i].Replace('\\', '-');
                name = name.Substring(6);
                name = name.Remove(name.IndexOf('.'));
                string source = $@"// <auto-generated/>
                
using System;

namespace  ClassLibraryPart_1
{{
    
    public partial class Vault
    {{
        static partial void Load{i}(Vault v) 
        {{
            //var files = System.IO.Directory.GetFiles(""nodes"");
           // System.Console.WriteLine(files.Length);
            v.nodes.Add(new Node(""{name}"",""{System.IO.File.ReadAllText(files[i])}""));
          //  Console.WriteLine($""Geytrtor says: frgngff3 '''"");
        }}
    }}
}}
";
                context.AddSource($"{i}.g.cs", source);
            }

        }

        public void Initialize(GeneratorInitializationContext context)
        {
            // No initialization required for this one
        }
    }
}